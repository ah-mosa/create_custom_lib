<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Custom Bundler - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <style>
        /* Ø£Ù†Ù…Ø§Ø· CSS Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --danger-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .content {
            padding: 40px;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .status-icon {
            width: 50px;
            height: 50px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .status-info h3 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .status-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .upload-area {
            border: 3px dashed var(--primary-color);
            border-radius: 10px;
            padding: 60px 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(67, 97, 238, 0.05);
        }
        
        .upload-area:hover {
            background: rgba(67, 97, 238, 0.1);
            border-color: var(--secondary-color);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        footer {
            background: #343a40;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            padding: 20px;
            max-width: 400px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 3000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .notification.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .notification.warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .analysis-results {
            max-height: 500px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }
        
        .library-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        
        .library-name {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .library-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .library-stat {
            background: white;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .functions-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .function-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-btn {
            padding: 10px 20px;
            background: var(--light-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .quick-actions {
                flex-direction: column;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-code"></i> JS Custom Bundler</h1>
            <p class="subtitle">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆÙŠØ¨</p>
        </header>
        
        <div class="content">
            <div class="status">
                <div class="status-icon"><i class="fas fa-check"></i></div>
                <div class="status-info">
                    <h3>Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h3>
                    <p>Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</p>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="projectsCount">0</div>
                    <div class="stat-label">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="bundlesCount">0</div>
                    <div class="stat-label">Ø§Ù„Ø­Ø²Ù…</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="reportsCount">0</div>
                    <div class="stat-label">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="tasksCount">0</div>
                    <div class="stat-label">Ø§Ù„Ù…Ù‡Ø§Ù…</div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-upload"></i> Ø±ÙØ¹ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h2>
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt fa-3x" style="color: var(--primary-color); margin-bottom: 15px;"></i>
                    <p>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„Ù ZIP Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‡Ù†Ø§</p>
                    <p style="color: #666; margin-top: 10px; font-size: 0.9rem;">Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù</p>
                </div>
                <input type="file" id="fileInput" accept=".zip" style="display: none;">
                
                <div class="form-group">
                    <label for="projectName"><i class="fas fa-folder"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</label>
                    <input type="text" id="projectName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...">
                </div>
                
                <div class="actions">
                    <button class="btn btn-primary" onclick="uploadProject()">
                        <i class="fas fa-upload"></i> Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„
                    </button>
                    <button class="btn btn-secondary" onclick="debugCurrentProject()">
                        <i class="fas fa-bug"></i> ØªØ´Ø®ÙŠØµ
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-bolt"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="listAllProjects()">
                        <i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
                    </button>
                    <button class="quick-btn" onclick="checkSystemHealth()">
                        <i class="fas fa-heartbeat"></i> ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…
                    </button>
                    <button class="quick-btn" onclick="cleanupSystem()">
                        <i class="fas fa-broom"></i> ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø¸Ø§Ù…
                    </button>
                    <button class="quick-btn" onclick="showRecentTasks()">
                        <i class="fas fa-tasks"></i> Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                    </button>
                </div>
            </div>
            
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p id="loadingText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="loadingProgress"></div>
                    </div>
                </div>
            </div>
            
            <div id="results" class="card hidden">
                <h2><i class="fas fa-chart-bar"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„</h2>
                <div id="resultsContent"></div>
            </div>
            
            <div id="debugInfo" class="card hidden">
                <h2><i class="fas fa-bug"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ</h2>
                <div id="debugContent"></div>
            </div>
        </div>
        
        <footer>
            <p>JS Custom Bundler &copy; 2024 | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„ÙˆÙŠØ¨</p>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.0.0</p>
        </footer>
    </div>
    
    <div id="notification" class="notification">
        <div id="notificationMessage"></div>
    </div>
    
    <script>
        // Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let currentProject = null;
        let currentAnalysis = null;
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            loadStats();
            setupUpload();
            setupNotification();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(loadStats, 30000);
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø© ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
            setInterval(loadActiveTasks, 10000);
        });
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function setupNotification() {
            const notification = document.getElementById('notification');
            notification.addEventListener('click', function() {
                this.classList.remove('show');
            });
        }
        
        // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.getElementById('notification');
            const messageEl = document.getElementById('notificationMessage');
            
            if (!notification || !messageEl) return;
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù„ÙˆÙ†
            messageEl.textContent = message;
            notification.className = `notification show ${type}`;
            
            // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function setupUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'rgba(67, 97, 238, 0.1)';
                uploadArea.style.borderColor = '#3a0ca3';
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.style.background = '';
                uploadArea.style.borderColor = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = '';
                uploadArea.style.borderColor = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (fileInput.files.length > 0) {
                    handleFileUpload(fileInput.files[0]);
                }
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('projectsCount').textContent = data.projects_count;
                    document.getElementById('bundlesCount').textContent = data.bundles_count;
                    document.getElementById('reportsCount').textContent = data.analysis_count;
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©
                    const tasks = await fetch('/api/tasks').then(r => r.json());
                    if (tasks) {
                        const activeTasks = tasks.filter(t => 
                            t.status === 'running' || t.status === 'pending'
                        ).length;
                        document.getElementById('tasksCount').textContent = activeTasks;
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©
        async function loadActiveTasks() {
            try {
                const response = await fetch('/api/tasks');
                const tasks = await response.json();
                
                if (tasks && tasks.length > 0) {
                    const activeTasks = tasks.filter(t => 
                        t.status === 'running' || t.status === 'pending'
                    );
                    
                    if (activeTasks.length > 0) {
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
                        document.getElementById('tasksCount').textContent = activeTasks.length;
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
                        if (currentProject) {
                            const projectTask = activeTasks.find(t => 
                                t.task_type === 'analyze_project' && 
                                t.result && 
                                t.result.analysis_id && 
                                t.result.analysis_id.includes(currentProject)
                            );
                            
                            if (projectTask && projectTask.status === 'running') {
                                updateLoading(projectTask.message, projectTask.progress);
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…:', error);
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
        async function handleFileUpload(file) {
            if (!file.name.endsWith('.zip')) {
                showNotification('âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© ZIP', 'warning');
                return;
            }
            
            const projectName = document.getElementById('projectName').value || 
                               file.name.replace('.zip', '');
            
            if (!projectName.trim()) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', 'warning');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...');
            
            const formData = new FormData();
            formData.append('project_name', projectName);
            formData.append('file', file);
            
            try {
                const response = await fetch('/api/projects', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    currentProject = projectName;
                    loadStats();
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    setTimeout(() => {
                        analyzeProject(projectName);
                    }, 1000);
                } else {
                    throw new Error(result.detail || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Ø±ÙØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        function uploadProject() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length > 0) {
                handleFileUpload(fileInput.files[0]);
            } else {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'warning');
            }
        }
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        async function analyzeProject(projectId) {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...');
            
            try {
                const response = await fetch(`/api/projects/${projectId}/analyze`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('âœ… ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', 'success');
                    
                    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
                    monitorTask(result.task_id, projectId, 'analysis');
                } else {
                    throw new Error(result.detail || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
                hideLoading();
            }
        }
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
        async function monitorTask(taskId, projectId, taskType) {
            const checkInterval = setInterval(async () => {
                try {
                    const response = await fetch(`/api/tasks/${taskId}`);
                    const task = await response.json();
                    
                    if (response.ok) {
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
                        updateLoading(task.message, task.progress);
                        
                        // Ø¥Ø°Ø§ Ø§ÙƒØªÙ…Ù„Øª
                        if (task.status === 'completed') {
                            clearInterval(checkInterval);
                            showNotification('âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            hideLoading();
                            
                            if (taskType === 'analysis') {
                                currentAnalysis = task.result;
                                showAnalysisDetails(projectId);
                            } else if (taskType === 'bundles') {
                                showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                                showBundleResults(task.result);
                            }
                            
                            loadStats();
                        } else if (task.status === 'failed') {
                            clearInterval(checkInterval);
                            showNotification(`âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ${task.error}`, 'error');
                            hideLoading();
                        }
                    }
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù‡Ù…Ø©:', error);
                }
            }, 1000);
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        async function showAnalysisDetails(projectId) {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„...');
            
            try {
                const response = await fetch(`/api/projects/${projectId}/analysis`);
                
                if (response.status === 404) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¹Ø¯');
                }
                
                if (!response.ok) {
                    throw new Error(`Ø®Ø·Ø£ ${response.status}: ${response.statusText}`);
                }
                
                const analysis = await response.json();
                
                if (!analysis || Object.keys(analysis).length === 0) {
                    throw new Error('Ù…Ù„Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙØ§Ø±Øº Ø£Ùˆ ØªØ§Ù„Ù');
                }
                
                displayDetailedAnalysis(analysis, projectId);
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
                showDebugInfo(error.message, projectId);
            } finally {
                hideLoading();
            }
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
        function displayDetailedAnalysis(analysis, projectId) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            let html = `
                <div style="text-align: right;">
                    <h3 style="color: #333; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 20px;">
                        ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ - ${projectId}
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 2rem; color: var(--primary-color); font-weight: bold;">${analysis.total_files || 0}</div>
                            <div style="color: #666;">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù…Ø³ÙˆØ­Ø©</div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 2rem; color: var(--primary-color); font-weight: bold;">${analysis.libraries ? Object.keys(analysis.libraries).length : 0}</div>
                            <div style="color: #666;">Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©</div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 2rem; color: var(--primary-color); font-weight: bold;">${analysis.total_functions || 0}</div>
                            <div style="color: #666;">Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                        </div>
                    </div>
            `;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©
            if (analysis.libraries && Object.keys(analysis.libraries).length > 0) {
                html += `
                    <h4 style="color: #333; margin: 20px 0 10px 0;"><i class="fas fa-box"></i> Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</h4>
                    <div class="analysis-results">
                `;
                
                for (const [lib, data] of Object.entries(analysis.libraries)) {
                    const percentage = ((data.count / analysis.total_files) * 100).toFixed(1);
                    
                    html += `
                        <div class="library-item">
                            <div class="library-name">${lib}</div>
                            <div>ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ ${data.count} Ù…Ù„Ù (${percentage}%)</div>
                            
                            ${data.functions_used && data.functions_used.length > 0 ? `
                            <div style="margin-top: 10px;">
                                <strong style="color: #666; font-size: 0.9rem;">Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong>
                                <div class="functions-list">
                                    ${data.functions_used.slice(0, 10).map(func => `
                                        <span class="function-tag">${func}</span>
                                    `).join('')}
                                    ${data.functions_used.length > 10 ? `
                                        <span class="function-tag">+${data.functions_used.length - 10} Ø£ÙƒØ«Ø±</span>
                                    ` : ''}
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="library-stats">
                                <span class="library-stat">ğŸ“ ${data.count} Ù…Ù„Ù</span>
                                <span class="library-stat">ğŸ”§ ${data.functions_used ? data.functions_used.length : 0} Ø¯Ø§Ù„Ø©</span>
                            </div>
                        </div>
                    `;
                }
                
                html += `</div>`;
                
                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                html += `
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-success" onclick="createBundlesForProject('${projectId}')" 
                                style="flex: 1; padding: 15px; font-size: 1.1rem;">
                            <i class="fas fa-box"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù… Ù…Ø®ØµØµØ©
                        </button>
                        
                        <button class="btn btn-primary" onclick="downloadReport('${projectId}')" 
                                style="flex: 1; padding: 15px; font-size: 1.1rem;">
                            <i class="fas fa-file-pdf"></i> Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <strong>ğŸ“ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> 
                        <code style="background: white; padding: 5px 10px; border-radius: 4px; margin-right: 10px;">
                            projects/${projectId}/
                        </code>
                    </div>
                `;
            } else {
                html += `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-search fa-3x" style="margin-bottom: 20px;"></i>
                        <h3>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙƒØªØ¨Ø§Øª</h3>
                        <p>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø§Øª JavaScript Ø®Ø§Ø±Ø¬ÙŠØ©</p>
                    </div>
                `;
            }
            
            contentDiv.innerHTML = html;
            resultsDiv.classList.remove('hidden');
            document.getElementById('debugInfo').classList.add('hidden');
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù… Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
        async function createBundlesForProject(projectId) {
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù…Ø®ØµØµØ©...');
            
            try {
                const response = await fetch(`/api/projects/${projectId}/bundles`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…', 'success');
                    monitorTask(result.task_id, projectId, 'bundles');
                } else {
                    throw new Error(result.detail || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
                hideLoading();
            }
        }
        
        // Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø²Ù…
        function showBundleResults(result) {
            if (!result || !result.bundles) return;
            
            let message = `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${Object.keys(result.bundles).length} Ø­Ø²Ù…Ø© Ù…Ø®ØµØµØ©:

`;
            
            Object.entries(result.bundles).forEach(([lib, path]) => {
                message += `â€¢ ${lib}: ${path}
`;
            });
            
            message += `
ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ†Ø²ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø²Ù… Ù…Ù†: ${result.zip_path}`;
            
            Swal.fire({
                title: 'Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©',
                text: message,
                icon: 'success',
                confirmButtonText: 'ØªÙ…',
                width: '600px'
            });
        }
        
        // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        async function downloadReport(projectId) {
            try {
                const response = await fetch(`/api/projects/${projectId}/reports`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'success');
                    
                    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
                    const checkInterval = setInterval(async () => {
                        try {
                            const taskResponse = await fetch(`/api/tasks/${result.task_id}`);
                            const task = await taskResponse.json();
                            
                            if (taskResponse.ok && task.status === 'completed') {
                                clearInterval(checkInterval);
                                
                                if (task.result && task.result.report_url) {
                                    window.open(task.result.report_url, '_blank');
                                    showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'success');
                                }
                            } else if (task.status === 'failed') {
                                clearInterval(checkInterval);
                                showNotification(`âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${task.error}`, 'error');
                            }
                        } catch (error) {
                            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
                        }
                    }, 1000);
                } else {
                    throw new Error(result.detail || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
            }
        }
        
        // ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        async function debugCurrentProject() {
            const projectName = document.getElementById('projectName').value;
            if (!projectName.trim()) {
                showNotification('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ...');
            
            try {
                const response = await fetch(`/api/projects/${projectName}/debug`);
                const debugInfo = await response.json();
                
                if (response.ok) {
                    displayDebugInfo(debugInfo);
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ
        function displayDebugInfo(debugInfo) {
            const debugDiv = document.getElementById('debugInfo');
            const contentDiv = document.getElementById('debugContent');
            
            let html = `
                <h3 style="color: #333; border-bottom: 2px solid #ff9800; padding-bottom: 10px; margin-bottom: 20px;">
                    ğŸ› Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ - ${debugInfo.project_id}
                </h3>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>Ø§Ù„Ù…Ø³Ø§Ø±:</strong> ${debugInfo.project_path}<br>
                    <strong>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯:</strong> ${debugInfo.project_exists ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}<br>
                    <strong>Ù…Ù„Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯:</strong> ${debugInfo.analysis_file_exists ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}<br>
                    ${debugInfo.analysis_file_error ? `<strong>Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> ${debugInfo.analysis_file_error}<br>` : ''}
                </div>
            `;
            
            if (debugInfo.project_exists) {
                html += `
                    <h4 style="color: #333; margin: 20px 0 10px 0;">ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (${debugInfo.files_in_project.length}):</h4>
                    <div style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                `;
                
                if (debugInfo.files_in_project.length > 0) {
                    debugInfo.files_in_project.forEach(file => {
                        html += `
                            <div style="padding: 5px 10px; border-bottom: 1px solid #eee; font-family: monospace; font-size: 0.9rem;">
                                ${file.is_file ? 'ğŸ“„' : 'ğŸ“'} ${file.path}
                                ${file.is_file ? `(${formatFileSize(file.size)})` : ''}
                            </div>
                        `;
                    });
                } else {
                    html += `<div style="color: #666; text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª</div>`;
                }
                
                html += `</div>`;
                
                // Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                html += `
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="forceAnalyzeProject('${debugInfo.project_id}')" 
                                style="margin-right: 10px;">
                            <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                        </button>
                        ${debugInfo.analysis_file_exists ? `
                        <button class="btn btn-warning" onclick="showAnalysis('${debugInfo.project_id}')">
                            <i class="fas fa-chart-bar"></i> Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
                        </button>
                        ` : ''}
                    </div>
                `;
            } else {
                html += `
                    <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 20px;">
                        âŒ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯! ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØµØ­ÙŠØ­.
                    </div>
                `;
            }
            
            contentDiv.innerHTML = html;
            debugDiv.classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        async function forceAnalyzeProject(projectId) {
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...');
            
            try {
                const response = await fetch(`/api/projects/${projectId}/analyze`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„', 'success');
                    monitorTask(result.task_id, projectId, 'analysis');
                } else {
                    throw new Error(result.detail || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
                hideLoading();
            }
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
        async function listAllProjects() {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹...');
            
            try {
                const response = await fetch('/api/projects');
                const projects = await response.json();
                
                if (response.ok) {
                    displayProjectsList(projects);
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹');
                }
            } catch (error) {
                showNotification(`âŒ ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
        function displayProjectsList(projects) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            let html = `
                <h3 style="color: #333; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 20px;">
                    ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (${projects.length})
                </h3>
            `;
            
            if (projects.length > 0) {
                html += `<div style="max-height: 400px; overflow-y: auto;">`;
                
                projects.forEach(project => {
                    const hasAnalysis = project.has_analysis || false;
                    
                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; 
                                    border: 1px solid ${hasAnalysis ? '#c3e6cb' : '#f5c6cb'};">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--primary-color); font-size: 1.1rem;">${project.name}</strong>
                                    <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                                        ğŸ“ ${formatFileSize(project.size)} â€¢ ğŸ“„ ${project.file_count} Ù…Ù„Ù
                                    </div>
                                    <div style="color: #888; font-size: 0.8rem; margin-top: 3px;">
                                        ğŸ• ${new Date(project.created_at).toLocaleString('ar')}
                                    </div>
                                </div>
                                <div>
                                    <span style="background: ${hasAnalysis ? '#d4edda' : '#f8d7da'}; 
                                              color: ${hasAnalysis ? '#155724' : '#721c24'}; 
                                              padding: 5px 10px; border-radius: 20px; font-size: 0.8rem;">
                                        ${hasAnalysis ? 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„' : 'âŒ Ù„Ù… ÙŠØ­Ù„Ù„'}
                                    </span>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-primary" onclick="showAnalysis('${project.id}')" 
                                        style="padding: 8px 15px; font-size: 0.8rem;">
                                    <i class="fas fa-chart-bar"></i> ØªØ­Ù„ÙŠÙ„
                                </button>
                                <button class="btn btn-secondary" onclick="debugProject('${project.id}')" 
                                        style="padding: 8px 15px; font-size: 0.8rem;">
                                    <i class="fas fa-bug"></i> ØªØ´Ø®ÙŠØµ
                                </button>
                                <button class="btn btn-success" onclick="createBundlesForProject('${project.id}')" 
                                        style="padding: 8px 15px; font-size: 0.8rem;" 
                                        ${!hasAnalysis ? 'disabled' : ''}>
                                    <i class="fas fa-box"></i> Ø­Ø²Ù…
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            } else {
                html += `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯
                        <p style="margin-top: 10px;">Ø§Ø¨Ø¯Ø£ Ø¨Ø±ÙØ¹ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ğŸ‘†</p>
                    </div>
                `;
            }
            
            contentDiv.innerHTML = html;
            resultsDiv.classList.remove('hidden');
            document.getElementById('debugInfo').classList.add('hidden');
        }
        
        // ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        async function checkSystemHealth() {
            try {
                const response = await fetch('/api/health');
                const health = await response.json();
                
                if (response.ok) {
                    Swal.fire({
                        title: 'ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù…',
                        html: `
                            <div style="text-align: right;">
                                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${health.status}</p>
                                <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${health.version}</p>
                                <p><strong>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong> ${health.message}</p>
                                <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${new Date(health.timestamp * 1000).toLocaleString('ar')}</p>
                            </div>
                        `,
                        icon: 'success',
                        confirmButtonText: 'ØªÙ…'
                    });
                }
            } catch (error) {
                showNotification('âŒ ÙØ´Ù„ ÙÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
            }
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø¸Ø§Ù…
        async function cleanupSystem() {
            try {
                const response = await fetch('/api/cleanup', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    loadStats();
                }
            } catch (error) {
                showNotification('âŒ ÙØ´Ù„ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
            }
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
        async function showRecentTasks() {
            try {
                const response = await fetch('/api/tasks');
                const tasks = await response.json();
                
                if (tasks && tasks.length > 0) {
                    let message = `Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (${tasks.length}):

`;
                    
                    tasks.slice(0, 5).forEach(task => {
                        const statusIcon = {
                            'pending': 'â³',
                            'running': 'ğŸ”„',
                            'completed': 'âœ…',
                            'failed': 'âŒ',
                            'cancelled': 'â›”'
                        }[task.status] || 'â“';
                        
                        message += `${statusIcon} ${task.task_type}: ${task.status} (${task.progress}%)
`;
                    });
                    
                    Swal.fire({
                        title: 'Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ«Ø©',
                        text: message,
                        icon: 'info',
                        confirmButtonText: 'ØªÙ…'
                    });
                } else {
                    showNotification('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ©', 'info');
                }
            } catch (error) {
                showNotification('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…', 'error');
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showLoading(message) {
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loadingText');
            
            if (loading && loadingText) {
                loadingText.textContent = message;
                loading.classList.remove('hidden');
            }
        }
        
        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.classList.add('hidden');
            }
        }
        
        function updateLoading(message, progress) {
            const loadingText = document.getElementById('loadingText');
            const progressFill = document.getElementById('loadingProgress');
            
            if (loadingText && message) {
                loadingText.textContent = `${message} (${progress || 0}%)`;
            }
            
            if (progressFill) {
                progressFill.style.width = \`\${progress || 0}%\`;
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
            const k = 1024;
            const sizes = ['Ø¨Ø§ÙŠØª', 'ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª', 'Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
        function debugProject(projectId) {
            document.getElementById('projectName').value = projectId;
            debugCurrentProject();
        }
        
        function showAnalysis(projectId) {
            currentProject = projectId;
            showAnalysisDetails(projectId);
        }
    </script>
</body>
</html>